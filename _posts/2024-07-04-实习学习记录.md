---
title: 实习项目学习记录
date: 2024-07-04 15:22:00 +0800
categories: [工作, 实习]
tags: [实习]
---

## 实习第一印象  
在实习的第一天Leader就开放了一个项目给我看，第一天我基本上就在试图把这个项目在本地跑起来，然而直到下班都没有跑起来，可能还是缺少什么环境？给我的文档只是简单地涉及到了如何使用，没有提及部署这方面的内容，总而言之，有点看不懂。  
第二天带我的前辈部署了一个Demo给我点点试试看，完成度感觉还不是特别高，我也比较好奇这到底是个什么样的项目，在网上查查发现华为云也有一个类似的服务，叫做应用与数据集成平台。
>引用自华为云Stack 8.3.0 解决方案描述 01：  
>企业在向数字化转型的过程中会面临诸多难题：缺少统一的设备信息集成途径；数据格式多样化，难以传输和集成；缺少与合作伙伴分享数据和后端服务的便捷途径；缺少云上云下跨网络的安全信息通道。ROMA Connect是一个全栈式的应用与数据集成平台，聚焦应用和数据连接，适配多种企业常见的使用场景。ROMA Connect提供轻量化消息、数据、API、设备等集成能力，简化企业上云流程，支持云上云下、跨区域集成，帮助企业实现数字化转型。  

听起来还是有点云里雾里，但我大概还是稍微懂了一点，大概就是一个共同的数据传输平台，将各自的设备信息、数据、消息传输到平台，由平台执行设备信息可视化、监控告警、数据转换、消息传输等操作，又或是根据合作伙伴的要求转换数据格式，集成数据，企业完成数据和消息的集成之后，合作伙伴可以访问平台获取相关信息，总之我目前还是不太看得懂业务流程。

## 从登录注册开始  
~~是老朋友的预感......~~  
* **验证码**  
项目使用Kaptcha实现验证码功能，用到了其中的两个Bean，captchaProducer和captchaProducerMath。方法返回的是一个操作消息提醒AjaxResult类，是HashMap<String, Object>的拓展（用来存放键值对）。  
验证码信息的uuid由工具类中的randomUUID方法生成（还没搞懂什么原理），验证码verifyKey由CAPTCHA_CODE_KEY+uuid拼接而成，通过captchaProducer和captchaProducerMath生成验证码的code和image，以verifyKey为Key以code为value设置2分钟过期时间存入Redis，最后将uuid和转换流信息处理后的image写入返回实例ajax并返回。  
* **登录验证码校验**  
前端生成验证码的时候就会将uuid存入loginForm中，重新获取verifyKey，在Redis中根据Key获取value即需要我们输入的验证码，获取完毕后删除Redis中的数据，交由异步任务管理器进行处理（这块我不是很懂，要仔细研究下）。  
* **登录前置校验**  
主要是对用户名、密码格式进行校验，包括字符串是否为空、是否在指定范围内，另外还对IP黑名单进行校验处理，看了下黑名单是存在Redis中以SYS_CONFIG_KEY+sys.login.blackIPList为Key的系统配置部分的，这每一步校验也都是交给异步任务管理器处理的。  
* **用户验证**  
用户验证用到了SpringSecurity，用用户名和密码生成token，存在AuthenticationContextHolder的ThreadLocal中，供后面使用。然后注释里说authentication = authenticationManager.authenticate(authenticationToken);这个方法会调用UserDetailsServiceImpl.loadUserByUsername（还没搞懂为什么是这样），总之这个方法会返回该用户名的用户实体对象，我们从ThreadLocal中获取token后提取出用户名密码，若失败则会以PWD_ERR_CNT_KEY+username为Key，重试次数为value存在Redis中，保证用户登录失败重试次数不超过设定值，成功后就会从Redis中删除该记录并创建LoginUser实体（这里还涉及到权限问题，到时候再来看看），之后会清除ThreadLocal中的token，交由异步任务处理登录，记录登录信息，生成token返回前端。（那么各种操作的鉴权是怎么进行的呢，现在Redis里已经没有用户token了啊）  
## 应用管理和流程图

## 连接器