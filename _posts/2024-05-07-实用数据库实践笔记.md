---
title: 实用数据库实践笔记
date: 2024-05-07 17:32:00 +0800
categories: [学习, 数据库]
tags: [数据库]
---

主要是这门课后面有个考试，想必能用得上。（决定重写，聚焦于操作而不是知识点，待更新）

## MySQL的导入和导出
1. **使用select into outfile导出**   
   先使用su在root用户下，启动mysql服务：service mysql start，再登录mysql：mysql -uroot -p123456  
   使用show databases;可以查看mysql下所有数据库，在这里use scott;使用先前导入的scott数据库    

   导出数据库例如：**select * from scott.emp into outfile '/data/mysql/emp.txt' fields terminated by ',' optionally enclosed by '"' lines terminated by '\n';**  
   在这里通过show variables like '%secure%'\G会发现文件安全性参数为空，vim /etc/my.cnf进行更改，在其中加入secure_file_priv=/data/mysql，service mysql restart重启服务，使用grant file on *.* to 'root'@'%';给权限，输入flush privileges;刷新即可解决。  
2. **使用LOAD DATA INFILE导入**  
   use hr;切换到hr数据库，创建表create table hr.emp like scott.emp;再导入数据**LOAD DATA INFILE '/data/mysql/emp.txt' INTO TABLE hr.emp FIELDS TERMINATED BY ',' ENCLOSED BY '"' LINES TERMINATED BY '\n';**

## 外部表
1. **创建外部表**  
   总体过程：
   * 产生外部表的定义  
   * 指定驱动类型和默认目录  
   * 指定访问参数（记录终结，字段终结，空字段）  
   * 指定字段顺序
   * 指定数据文件  
   创建外部表的一个示例：create table scott.ex1(empno int,deptno int,ename varchar(20)) ORGANIZATION EXTERNAL (type oracle_loader default directory expdp_dest access parameters (records delimited by newline fields terminated by ',' missing field values are null (empno,deptno,ename)) location('employees.dat'));  
2. **外部表卸载**  
   示例：create table scott.ex2(empno,ename,sal) ORGANIZATION EXTERNAL (type oracle_datapump default directory expdp_dest location('emp1.dat')) as select empno,ename,sal from scott.emp;
3. **外部表加载**  
   示例：create table scott.ex(empno int,ename varchar(20),sal number(7,2)) ORGANIZATION EXTERNAL (type oracle_datapump default directory expdp_dest location('emp1.dat'));

## RMAN
1. **基于时间点的恢复**
* **创建测试表**  
  create table scott.suibian(id int);  
  insert into scott.suibian values(100);  
  commit;  
  alter system archive log current; 归档模式，很多操作只有在这个模式才能进行  
* **整库备份**  
  在RMAN中backup databse;  
* **再插入一条记录**  
  insert into scott.suibian values(200);  
  commit;  
* **查看时间(!date)**  
* **删除表**  
  drop table scott.suibian purge;  
* **创建表**  
  create table scott.suibian2 as select * from scott.emp;  
* **启动数据库到mount阶段**  
* **设置环境变量**   
  export NLS_DATE_FORMAT = "yyyy-mm-dd hh24:mi:ss"  
* **还原数据库**  
  RMAN下restore database;
* **恢复数据库到指定时间点**  
  RMAN下recover database until time '2023-08-27 14:17:34';  
* **打开数据库**  
  RMAN下alter databse open resetlogs;
2. **其他恢复**  
这里本来想复习一下然后记录的，结果发现老师已经把之前的录播给删了，导致我也不知道这些命令是干什么的了，简单记录一下防止找不到了。
* backup tablespace users;  
* configure channel device type disk format '/u01/salesbak/%d_%u_%T';  
* CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO ''  
* CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE DISK TO '/u01/salesbak/auto/%F';  
* backup database plus archivelog;   
* restore spfile from '/u01/salesbak/auto/c-1898917404-20240528-00';  
* restore controlfile from '/u01/salesbak/auto/c-1898917404-20240528-00';  
* restore database;

## 辅助数据库
1. **创建辅助数据库oradup**  
* oracle下archive log list;检查是否是归档模式  
* 在oracle，ljy库下create pfile from spfile;  
* cd $ORACLE_HOME/dbs在目录下cp initljy.ora initoradup.ora  
* vim initoradup.ora，使用1,$ s/ljy/sales/oradup/g，将所有ljy替换为oradup   
* 使用select name from v$datafile;查看数据文件目录  
* 使用select name from v$logfile;查看日志文件目录  
* 给initoradup.ora添加下面三个参数：   
DB_FILE_NAME_CONVERT=('/u01/app/oracle/oradata/ljy/','/u01/app/oracle/oradata/oradup/')  
LOG_FILE_NAME_CONVERT=('/u01/app/oracle/oradata/ljy/','/u01/app/oracle/oradata/oradup/')  
log_archive_dest_1='location=/u01/arch/oradup'  
* 注意创建文件里暂时不存在的目录：   
mkdir -p /u01/arch/oradup  
mkdir -p /u01/app/oracle/admin/oradup/adump  
mkdir -p /u01/app/oracle/fast_recovery_area/oradup  
* 配置口令验证文件  
在dbs下orapwd file=orapworadup password=admin1#3  
* 配置监听和服务名  
netmgr进行配置  